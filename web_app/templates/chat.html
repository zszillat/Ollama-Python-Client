{% extends "base.html" %}

{% block title %}Chat - Local ChatGPT{% endblock %}

<!-- TOPBAR -->
{% block topbar %}
    <label for="model-select">Model:</label>
    <select id="model-select">
        <option>qwen2.5-coder:1.5b</option>
        <option>deepseek-coder-v2:16b</option>
        <option>llama3:latest</option>
    </select>
{% endblock %}

<!-- MAIN -->
{% block content %}


    <div id="chat">
        {% for message in messages %}
        <div class="{{ message.role }}">
            <strong>{{ message.role.capitalize() }}:</strong> 
            <div class="message-content" data-content="{{ message.content | e }}"></div>
        </div>                               
        {% endfor %}
    </div>

    <form action="/chat" method="post" id="chat-form">
        <input type="text" name="user_input" placeholder="Type your message..." required autofocus>
        <button type="submit">Send</button>
    </form>
{% endblock %}

{% block scripts %}
<script>
    const chatDiv = document.getElementById("chat");
    chatDiv.scrollTop = chatDiv.scrollHeight;

    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".message-content").forEach(div => {
            const raw = div.getAttribute("data-content");
            div.innerHTML = marked.parse(raw);
        });

        Prism.highlightAll();
    });
</script>
{% endblock %}
